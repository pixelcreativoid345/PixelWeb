<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Creativo - Panel de Control</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, query, orderBy, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables provided by Canvas environment - EXPLICITLY ATTACH TO WINDOW
        window.appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        window.firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};

        window.firebaseApp = null;
        window.firebaseAuth = null;
        window.firebaseDb = null;
        window.developerLoggedIn = false;
        window.developerUserId = null; // To store the specific developer's UID
        window.developerEmailRegistered = false; // Flag to track if a developer email is registered

        if (Object.keys(window.firebaseConfig).length > 0) { // Use window.firebaseConfig
            window.firebaseApp = initializeApp(window.firebaseConfig); // Use window.firebaseConfig
            window.firebaseAuth = getAuth(window.firebaseApp);
            window.firebaseDb = getFirestore(window.firebaseApp);

            const DEVELOPER_LOGGED_IN_KEY = `dev_logged_in_${window.appId}`; // Use window.appId
            const DEVELOPER_UID_KEY = `dev_uid_${window.appId}`; // Use window.appId
            const developerEmailStoreRef = collection(window.firebaseDb, `artifacts/${window.appId}/developerSettings`); // Use window.appId
            let currentDeveloperConfigDocId = null; // Store the doc ID for the developer config

            async function checkDeveloperRegistrationStatus() {
                try {
                    const q = query(developerEmailStoreRef);
                    const querySnapshot = await getDocs(q);
                    if (!querySnapshot.empty) {
                        window.developerEmailRegistered = true;
                        querySnapshot.forEach(doc => {
                            currentDeveloperConfigDocId = doc.id; // Get the doc ID
                        });
                        document.getElementById('dev-register-checkbox-container').classList.add('hidden');
                        document.getElementById('dev-login-submit-btn').textContent = 'Entrar';
                    } else {
                        window.developerEmailRegistered = false;
                        document.getElementById('dev-register-checkbox-container').classList.remove('hidden');
                        document.getElementById('dev-login-submit-btn').textContent = 'Registrarme y Entrar';
                    }
                } catch (error) {
                    console.error("Error al verificar estado de registro de desarrollador:", error);
                }
            }

            onAuthStateChanged(window.firebaseAuth, (user) => {
                const devModeSection = document.getElementById('developer-mode');
                const devLoginModal = document.getElementById('developer-login-modal');
                const devLogoutBtn = document.getElementById('dev-logout-btn');
                const devModeNavLink = document.getElementById('dev-mode-nav-link');

                if (user && user.uid === localStorage.getItem(DEVELOPER_UID_KEY)) {
                    window.developerLoggedIn = true;
                    window.developerUserId = user.uid;
                    devModeSection.classList.remove('hidden');
                    devModeNavLink.classList.remove('hidden');
                    devLoginModal.classList.add('hidden');
                    devLogoutBtn.classList.remove('hidden');
                    console.log("Developer logged in:", user.uid);
                    loadStories();
                    loadDeveloperSettings();
                    loadContactMessages(); // Load contact messages when developer logs in
                } else {
                    window.developerLoggedIn = false;
                    window.developerUserId = null;
                    devModeSection.classList.add('hidden');
                    devModeNavLink.classList.add('hidden');
                    devLogoutBtn.classList.add('hidden');
                    console.log("Not developer logged in.");
                }
                checkDeveloperRegistrationStatus(); // Always check status on auth change
            });

            async function handleDeveloperAuth(email, password, isRegister) {
                const auth = window.firebaseAuth;
                try {
                    if (isRegister) {
                        if (window.developerEmailRegistered) {
                            alert("Ya existe una cuenta de desarrollador. Por favor, iniciá sesión.");
                            return;
                        }
                        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                        await setDoc(doc(developerEmailStoreRef, 'config'), { email: email, uid: userCredential.user.uid }); // Use setDoc with fixed ID for single config
                        alert("Registro de desarrollador exitoso. ¡Bienvenido!");
                        localStorage.setItem(DEVELOPER_LOGGED_IN_KEY, 'true');
                        localStorage.setItem(DEVELOPER_UID_KEY, userCredential.user.uid);
                    } else {
                        if (!window.developerEmailRegistered) {
                            alert("No hay una cuenta de desarrollador registrada. Por favor, registráte primero.");
                            return;
                        }
                        const userCredential = await signInWithEmailAndPassword(auth, email, password);
                        localStorage.setItem(DEVELOPER_LOGGED_IN_KEY, 'true');
                        localStorage.setItem(DEVELOPER_UID_KEY, userCredential.user.uid);
                        alert("Inicio de sesión de desarrollador exitoso. ¡Bienvenido!");
                    }
                    document.getElementById('developer-login-modal').classList.add('hidden');
                } catch (error) {
                    console.error("Error de autenticación:", error);
                    alert("Error: " + error.message);
                }
            }

            document.getElementById('developer-login-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const emailInput = document.getElementById('dev-email').value;
                const passwordInput = document.getElementById('dev-password').value;
                const isRegister = document.getElementById('dev-register-checkbox').checked;

                handleDeveloperAuth(emailInput, passwordInput, isRegister);
            });

            document.getElementById('dev-logout-btn').addEventListener('click', async () => {
                try {
                    await signOut(window.firebaseAuth);
                    localStorage.removeItem(DEVELOPER_LOGGED_IN_KEY);
                    localStorage.removeItem(DEVELOPER_UID_KEY);
                    alert("Sesión cerrada correctamente.");
                    document.getElementById('developer-login-modal').classList.add('hidden');
                } catch (error) {
                    console.error("Error al cerrar sesión:", error);
                    alert("Error al cerrar sesión: " + error.message);
                }
            });

            checkDeveloperRegistrationStatus(); // Initial check on load
        } else {
            console.warn("Firebase config not found. Developer mode and Firebase features will not be available.");
            document.getElementById('developer-mode').classList.add('hidden');
            document.getElementById('developer-login-modal').classList.add('hidden');
            document.getElementById('dev-mode-nav-link').classList.add('hidden');
        }
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Background: #F8F8F8, Text: #212121, Accent1 (Pink): #EC407A, Accent2 (Purple): #673AB7, Accent3 (Blue): #2196F3, Footer: #1A1A1A -->
    <!-- Application Structure Plan: Se diseñó una SPA tipo dashboard/landing page con navegación superior fija. La estructura se divide en secciones temáticas (Filosofía, Servicios, Portafolio, Herramientas, Contacto). Se añadió un "Modo Desarrollador" con acceso privado mediante login/registro único. Dentro del modo desarrollador, hay un "Laboratorio de Historias y Reflexiones" (CRUD para contenido tipo blog/casos de estudio con un generador de texto basado en una "matriz de ideas" y posibilidad de añadir imágenes Base64 al inicio, medio y fin del contenido) y una sección de gestión de imágenes (logo y banner) para cambiar su Base64. Las herramientas de IA permanecen públicas. Esta estructura fue elegida para diferenciar claramente la interfaz pública de la privada de gestión de contenido y personalización. Se agrega una sección de buzón de mensajes en modo desarrollador. -->
    <!-- Visualization & Content Choices: Para comparar los planes, se utiliza un gráfico de barras horizontales (Chart.js). Para la filosofía, tarjetas con íconos Unicode. Las herramientas LLM utilizan textareas para entrada y divs/img para salida. Las "Historias y Reflexiones" se gestionan con formularios de texto y una lista dinámica, persistiendo en Firestore. La gestión de imágenes en modo desarrollador utiliza inputs de texto para URLs. Se agrega un modal de formulario de contacto para el público y se visualizan los mensajes en modo desarrollador. Se confirma NO SVG y NO Mermaid. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8F8F8;
            color: #212121;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 400px;
            max-height: 50vh;
        }
        .nav-link {
            transition: color 0.3s;
        }
        .nav-link:hover {
            color: #EC407A; /* Accent1 */
        }
        .plan-card {
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .plan-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
        }
        .textarea-llm {
            min-height: 100px;
            resize: vertical;
        }
        .output-box {
            background-color: #f0f0f0;
            padding: 1rem;
            border-radius: 0.5rem;
            min-height: 80px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .image-output {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
            background-color: #f0f0f0;
            border-radius: 0.5rem;
            overflow: hidden;
        }
        .image-output img {
            max-width: 100%;
            height: auto;
            display: block;
        }
        /* Logo styling for circular frame with gradient */
        .logo-frame {
            border-radius: 50%;
            overflow: hidden;
            background: linear-gradient(to right, rgba(20, 30, 80, 0.8), rgba(20, 30, 80, 0.2)); /* Dark blue to transparent gradient */
            display: flex;
            align-items: center;
            justify-content: center;
            width: 50px; /* Adjust size as needed */
            height: 50px; /* Adjust size as needed */
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .logo-frame img {
            width: 80%; /* Ensure logo fits within the circular frame */
            height: 80%;
            object-fit: contain;
        }

        /* Portfolio card transparency */
        .bg-accent1-transparent { background-color: rgba(236, 64, 122, 0.7); } /* Pink with transparency */
        .bg-accent2-transparent { background-color: rgba(103, 58, 183, 0.7); } /* Purple with transparency */
        .bg-accent3-transparent { background-color: rgba(33, 150, 243, 0.7); } /* Blue with transparency */

        /* Developer mode button */
        .dev-mode-btn {
            background-color: #4CAF50; /* Green */
            color: white;
            padding: 15px 20px;
            border-radius: 50%; /* Make it round */
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 70px;
            height: 70px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: background-color 0.3s, transform 0.3s;
        }
        .dev-mode-btn:hover {
            background-color: #45a049;
            transform: translateY(-3px);
        }

        /* Modal styling */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
            width: 90%;
            max-width: 500px;
            text-align: center;
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        .story-image-preview {
            max-width: 100px;
            max-height: 100px;
            object-fit: contain;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-top: 5px;
            display: block;
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-[#F8F8F8]/80 backdrop-blur-sm sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="logo-frame">
                <!-- Logo Pixel Creativo (PNG) - Placeholder for Base64 data -->
                <img src="https://placehold.co/50x50/F8F8F8/212121?text=Logo" id="main-logo" alt="Pixel Creativo Logo">
            </div>
            
            <div class="hidden md:flex space-x-8">
                <a href="#filosofia" class="nav-link text-gray-700">Filosofía</a>
                <a href="#servicios" class="nav-link text-gray-700">Servicios</a>
                <a href="#portafolio" class="nav-link text-gray-700">Portafolio</a>
                <a href="#herramientas" class="nav-link text-gray-700">Herramientas ✨</a>
                <a href="#contacto" class="nav-link text-gray-700">Contacto</a>
                <a href="#developer-mode" id="dev-mode-nav-link" class="nav-link text-gray-700 hidden">Modo Desarrollador ⚙️</a>
                <button id="dev-logout-btn" class="bg-red-500 text-white text-sm font-semibold py-1 px-3 rounded-lg hover:bg-red-600 transition-colors hidden">Salir</button>
            </div>
        </nav>
    </header>

    <main>
        <section id="hero" class="py-20 md:py-32 bg-white relative">
            <img id="main-banner" src="https://placehold.co/1920x400/ECEFF1/607D8B?text=Tu+Banner+de+Portada" alt="Banner de Portada" class="absolute inset-0 w-full h-full object-cover opacity-30">
            <div class="container mx-auto px-6 text-center relative z-10">
                <h2 class="text-4xl md:text-6xl font-bold text-[#212121] leading-tight">Transformamos Píxeles en Historias que Conectan.</h2>
                <p class="mt-4 text-lg md:text-xl text-gray-600 max-w-3xl mx-auto">Más que diseño, creamos narrativas visuales que conectan con tu audiencia y potencian tu marca. En Pixel Creativo, tu idea es el lienzo donde la creatividad cobra vida.</p>
            </div>
        </section>

        <section id="filosofia" class="py-20">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h3 class="text-3xl font-bold">Nuestra Filosofía: La Alquimia Digital</h3>
                    <p class="mt-2 text-gray-600">Principios que impulsan cada proyecto que emprendemos.</p>
                </div>
                <div class="grid md:grid-cols-3 gap-8 text-center">
                    <div class="bg-white p-8 rounded-lg shadow-md">
                        <span class="text-4xl">🌱</span>
                        <h4 class="text-xl font-semibold mt-4">Método Kaizen</h4>
                        <p class="mt-2 text-gray-600">Creemos en la evolución constante, no en la perfección. Cada diseño es un paso adelante en el camino de tu marca y nuestra mejora continua.</p>
                    </div>
                    <div class="bg-white p-8 rounded-lg shadow-md">
                        <span class="text-4xl">✨</span>
                        <h4 class="text-xl font-semibold mt-4">Serendipia</h4>
                        <p class="mt-2 text-gray-600">Las mejores ideas surgen en el fluir del proceso creativo, mientras exploramos y jugamos. Encontramos magia en el descubrimiento inesperado.</p>
                    </div>
                    <div class="bg-white p-8 rounded-lg shadow-md">
                        <span class="text-4xl">⚗️</span>
                        <h4 class="text-xl font-semibold mt-4">Alquimia</h4>
                        <p class="mt-2 text-gray-600">Tomamos tu visión, un concepto, un píxel, y lo transformamos en algo valioso y significativo que deja una huella imborrable.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="servicios" class="py-20 bg-white">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h3 class="text-3xl font-bold">Nuestros Servicios y Planes</h3>
                    <p class="mt-2 text-gray-600">Soluciones flexibles para potenciar tu presencia digital. (Precios válidos para Agosto 2025)</p>
                </div>

                <div id="plan-cards-container" class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
                    <!-- Plans will be rendered here by JavaScript -->
                </div>

                <div class="mt-16 text-center">
                    <h4 class="text-2xl font-bold mb-4">Planes Exclusivos con Community Manager</h4>
                    <p class="text-gray-600 max-w-2xl mx-auto">Estos planes avanzados incluyen nuestro servicio especial de Community Manager, y son una excepción a nuestra oferta principal. Para una propuesta personalizada y detalles de costo, te invitamos a que nos contactes.</p>
                    <button id="request-cm-info-btn" class="mt-6 inline-block bg-[#2196F3] text-white font-bold py-3 px-8 rounded-lg hover:bg-opacity-90 transition-colors">
                        Solicitar Información CM
                    </button>
                </div>

                <div class="mt-20">
                    <h4 class="text-2xl font-bold text-center mb-8">Comparativa de Piezas por Planes Mensuales</h4>
                    <div class="chart-container">
                        <canvas id="plansChart"></canvas>
                    </div>
                </div>
                <p class="mt-8 text-sm text-gray-600 text-center">Todos los precios están expresados en Pesos Argentinos.</p>
            </div>
        </section>

        <section id="portafolio" class="py-20">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h3 class="text-3xl font-bold">Portafolio de Ejemplos</h3>
                    <p class="mt-2 text-gray-600">Un vistazo a la calidad y el estilo de nuestras creaciones.</p>
                </div>
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="bg-white rounded-lg shadow-md overflow-hidden">
                        <div class="h-48 bg-accent1-transparent flex items-center justify-center"> <!-- Accent1 with transparency -->
                             <span class="text-4xl text-white">📄</span>
                        </div>
                        <div class="p-6">
                            <h4 class="font-semibold text-lg">Flyer Estático Promocional</h4>
                            <p class="mt-2 text-gray-600">Un diseño con un mensaje claro, una imagen que atrapa y un llamado a la acción (CTA) directo para promocionar un producto o servicio.</p>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-md overflow-hidden">
                        <div class="h-48 bg-accent2-transparent flex items-center justify-center"> <!-- Accent2 with transparency -->
                            <span class="text-4xl text-white">🎠</span>
                        </div>
                        <div class="p-6">
                            <h4 class="font-semibold text-lg">Carrusel Educativo</h4>
                            <p class="mt-2 text-gray-600">Una serie de 3 a 5 imágenes que cuentan una historia secuencial o dan tips, ideal para aportar valor y educar a tu audiencia.</p>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-md overflow-hidden">
                        <div class="h-48 bg-accent3-transparent flex items-center justify-center"> <!-- Accent3 with transparency -->
                            <span class="text-4xl text-white">🎬</span>
                        </div>
                        <div class="p-6">
                            <h4 class="font-semibold text-lg">Reel de Narrativa Visual</h4>
                            <p class="mt-2 text-gray-600">Un video corto que usa el concepto de "antes y después" para mostrar una transformación impactante, sin necesidad de usar la cámara.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="herramientas" class="py-20 bg-gray-50">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h3 class="text-3xl font-bold">Herramientas ✨</h3>
                    <p class="mt-2 text-gray-600">Potencia tu creatividad con la ayuda de la Inteligencia Artificial.</p>
                </div>

                <div class="grid md:grid-cols-2 gap-12">
                    <div class="bg-white p-8 rounded-lg shadow-md">
                        <h4 class="text-xl font-semibold mb-4">Generador de Ideas de Contenido 💡</h4>
                        <p class="text-gray-600 mb-4">Pedile a nuestro modelo de IA que te genere ideas creativas para tus próximas piezas visuales. Describí el tema principal.</p>
                        <textarea id="content-idea-input" class="textarea-llm w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#EC407A]" placeholder="Tema del contenido (ej. 'Lanzamiento de curso de cocina', 'Beneficios del mindfulness')"></textarea>
                        <div class="relative mt-4">
                            <select id="content-type-select" class="block appearance-none w-full bg-white border border-gray-300 text-gray-700 py-3 px-4 pr-8 rounded-lg leading-tight focus:outline-none focus:bg-white focus:border-[#EC407A]">
                                <option value="Flyer Estático">Flyer Estático Promocional</option>
                                <option value="Carrusel Educativo">Carrusel Educativo</option>
                                <option value="Reel Narrativo">Reel de Narrativa Visual</option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                                <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                            </div>
                        </div>
                        <button id="generate-ideas-btn" class="mt-6 w-full bg-[#EC407A] text-white font-bold py-3 px-6 rounded-lg hover:bg-opacity-90 transition-colors flex items-center justify-center">
                            <span id="idea-spinner" class="hidden animate-spin h-5 w-5 mr-3 border-b-2 border-white rounded-full"></span>
                            Generar Ideas ✨
                        </button>
                        <div id="ideas-output" class="output-box mt-6 text-gray-700"></div>
                    </div>

                    <div class="md:col-span-1 bg-white p-8 rounded-lg shadow-md">
                        <h4 class="text-xl font-semibold mb-4">Generador de Imágenes y Logos 🎨</h4>
                        <p class="text-gray-600 mb-4">Toda idea es un bien poderoso si recibe el tratamiento correcto. En Pixel Creativo, valoramos cada voto de confianza de quienes nos traen sus visiones, porque nos tomamos las cosas en serio. Aquí puedes generar tu idea, y si te gusta, envíanosla por privado. Puede ser tu nuevo logo, un concepto para un flyer o lo que imagines; nosotros lo transformaremos en esa visión que tanto anhelas.</p>
                        <textarea id="image-prompt-input" class="textarea-llm w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#EC407A]" placeholder="Describí la imagen o logo. Ej: 'Un logo minimalista de un búho leyendo un libro, con colores neutros y un fondo simple para fácil remoción.'"></textarea>
                        <button id="generate-image-btn" class="mt-6 w-full bg-[#EC407A] text-white font-bold py-3 px-6 rounded-lg hover:bg-opacity-90 transition-colors flex items-center justify-center">
                            <span id="image-spinner" class="hidden animate-spin h-5 w-5 mr-3 border-b-2 border-white rounded-full"></span>
                            Generar Imagen ✨
                        </button>
                        <div id="image-output" class="image-output mt-6">
                            <p class="text-gray-500">La imagen generada aparecerá aquí.</p>
                        </div>
                        <p class="mt-4 text-sm text-gray-500">Nota: La transparencia del fondo puede requerir ajustes en una herramienta de edición externa.</p>
                    </div>

                </div>
            </div>
        </section>

        <section id="contacto" class="py-20 bg-white">
            <div class="container mx-auto px-6 text-center">
                <h3 class="text-3xl font-bold">¿Listo para que creemos algo increíble juntos?</h3>
                <p class="mt-2 text-gray-600 max-w-xl mx-auto">Contactanos para charlar sobre tu proyecto y cómo podemos potenciarlo al máximo.</p>
                <button id="open-contact-modal-btn" class="mt-8 inline-block bg-[#EC407A] text-white font-bold py-3 px-8 rounded-lg hover:bg-opacity-90 transition-colors">Hablemos</button>
            </div>
        </section>

        <!-- Developer Mode Button -->
        <div class="fixed bottom-6 right-6 z-40">
            <button id="open-dev-mode" class="dev-mode-btn">
                🌳<span class="text-3xl">🚪</span>
            </button>
        </div>

        <!-- Developer Login Modal -->
        <div id="developer-login-modal" class="modal">
            <div class="modal-content">
                <span class="close-button" id="close-login-modal">&times;</span>
                <h3 class="text-2xl font-bold mb-6 text-[#212121]">Acceso al Laboratorio Alquímico ⚙️</h3>
                <form id="developer-login-form" class="space-y-4">
                    <div>
                        <input type="email" id="dev-email" placeholder="Tu email de desarrollador" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#EC407A]" required>
                    </div>
                    <div>
                        <input type="password" id="dev-password" placeholder="Tu contraseña secreta" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#EC407A]" required>
                    </div>
                    <div id="dev-register-checkbox-container" class="flex items-center justify-center space-x-2">
                        <input type="checkbox" id="dev-register-checkbox" class="h-4 w-4 text-[#EC407A] rounded">
                        <label for="dev-register-checkbox" class="text-gray-700 text-sm">¿Es tu primer acceso? (Marcar para registrarse)</label>
                    </div>
                    <button type="submit" id="dev-login-submit-btn" class="w-full bg-[#673AB7] text-white font-bold py-3 px-6 rounded-lg hover:bg-opacity-90 transition-colors">Entrar</button>
                </form>
            </div>
        </div>

        <!-- Contact Form Modal -->
        <div id="contact-form-modal" class="modal">
            <div class="modal-content">
                <span class="close-button" id="close-contact-modal">&times;</span>
                <h3 class="text-2xl font-bold mb-6 text-[#212121]">¡Hablemos de tu proyecto!</h3>
                <form id="contact-form" class="space-y-4">
                    <div>
                        <input type="text" id="contact-name" placeholder="Tu Nombre" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#EC407A]" required>
                    </div>
                    <div>
                        <input type="email" id="contact-email" placeholder="Tu Correo Electrónico" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#EC407A]" required>
                    </div>
                    <div>
                        <input type="tel" id="contact-phone" placeholder="Tu Número de Contacto (Opcional)" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#EC407A]">
                    </div>
                    <div>
                        <textarea id="contact-message" class="textarea-llm w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#EC407A]" placeholder="Contanos tu petición o idea..." required></textarea>
                    </div>
                    <button type="submit" id="send-message-btn" class="w-full bg-[#EC407A] text-white font-bold py-3 px-6 rounded-lg hover:bg-opacity-90 transition-colors">
                        Enviar Mensaje
                    </button>
                </form>
            </div>
        </div>


        <!-- Developer Mode Section (Hidden by default) -->
        <section id="developer-mode" class="py-20 bg-gray-100 hidden">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h3 class="text-3xl font-bold text-[#212121]">Modo Desarrollador: Laboratorio Alquímico 🧪</h3>
                    <p class="mt-2 text-gray-600">Aquí podrás gestionar el contenido y la apariencia de tu sitio.</p>
                </div>

                <!-- Sección: Buzón de Contacto -->
                <div class="bg-white p-8 rounded-lg shadow-md mb-12">
                    <h4 class="text-2xl font-semibold mb-6">Buzón de Contacto 📩</h4>
                    <div id="contact-messages-list" class="space-y-4">
                        <p class="text-gray-500">Cargando mensajes...</p>
                    </div>
                </div>

                <!-- Sección: Historias y Reflexiones -->
                <div class="bg-white p-8 rounded-lg shadow-md mb-12">
                    <h4 class="text-2xl font-semibold mb-6">Historias y Reflexiones (Blog Alquímico) 📖</h4>
                    <form id="story-creation-matrix" class="space-y-4 mb-8">
                        <p class="text-gray-700 font-semibold">Matriz para generar tu historia:</p>
                        <div>
                            <input type="text" id="matrix-title" placeholder="Título para el generador de texto" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#EC407A]" required>
                        </div>
                        <div>
                            <input type="text" id="matrix-summary" placeholder="Resumen corto del contenido" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#EC407A]" required>
                        </div>
                        <div>
                            <input type="text" id="matrix-language" placeholder="Lenguaje a usar (ej: formal, coloquial, técnico)" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#EC407A]" value="formal relajado para público argentino" required>
                        </div>
                        <div>
                            <input type="text" id="matrix-style" placeholder="Estilo (ej: narrativo, informativo, poético)" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#EC407A]" value="narrativo, con reflexiones" required>
                        </div>
                        <div>
                            <input type="text" id="matrix-emotion" placeholder="Intención emocional (ej: inspirar, informar, motivar)" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#EC407A]" value="educar recordando, inspirar" required>
                        </div>
                        <div>
                            <textarea id="matrix-artistic-details" class="textarea-llm w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#EC407A]" placeholder="Detalles artísticos o tono (ej: metáforas de alquimia, referencias a Mendoza)"></textarea>
                        </div>
                        <button type="button" id="generate-story-text-btn" class="bg-[#2196F3] text-white font-bold py-2 px-4 rounded-lg hover:bg-opacity-90 transition-colors flex items-center justify-center">
                            <span id="story-text-spinner" class="hidden animate-spin h-5 w-5 mr-3 border-b-2 border-white rounded-full"></span>
                            Generar Texto Ejemplo
                        </button>
                    </form>

                    <div id="generated-story-preview" class="output-box mt-6 text-gray-700 hidden">
                        <p class="font-bold mb-2">Texto Generado:</p>
                        <div id="preview-content"></div>
                        <button type="button" id="confirm-story-text-btn" class="mt-4 bg-[#EC407A] text-white font-bold py-2 px-4 rounded-lg hover:bg-opacity-90 transition-colors">Usar este Texto</button>
                    </div>

                    <form id="story-form" class="space-y-4 mb-8 hidden"> <!-- This form becomes visible after confirming text -->
                        <input type="hidden" id="story-id">
                        <div>
                            <label for="story-title" class="block text-gray-700 text-sm font-bold mb-2">Título de la Historia:</label>
                            <input type="text" id="story-title" placeholder="Título de la Historia/Reflexión" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#EC407A]" required>
                        </div>
                        <div>
                            <label for="story-content-final" class="block text-gray-700 text-sm font-bold mb-2">Contenido de la Historia:</label>
                            <textarea id="story-content-final" class="textarea-llm w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#EC407A]" placeholder="Contenido de la historia o reflexión..."></textarea>
                        </div>
                        
                        <h5 class="text-xl font-semibold mt-8 mb-4">Imágenes para la Historia:</h5>
                        <div class="space-y-4">
                            <div>
                                <label for="story-image-start" class="block text-gray-700 text-sm font-bold mb-2">Imagen al Inicio (URL pública):</label>
                                <input type="url" id="story-image-start" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#EC407A]" placeholder="Pegá aquí la URL pública de la imagen de inicio...">
                                <img id="story-image-start-preview" class="story-image-preview">
                            </div>
                            <div>
                                <label for="story-image-middle" class="block text-gray-700 text-sm font-bold mb-2">Imagen al Medio (URL pública):</label>
                                <input type="url" id="story-image-middle" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#EC407A]" placeholder="Pegá aquí la URL pública de la imagen del medio...">
                                <img id="story-image-middle-preview" class="story-image-preview">
                            </div>
                            <div>
                                <label for="story-image-end" class="block text-gray-700 text-sm font-bold mb-2">Imagen al Final (URL pública):</label>
                                <input type="url" id="story-image-end" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#EC407A]" placeholder="Pegá aquí la URL pública de la imagen final...">
                                <img id="story-image-end-preview" class="story-image-preview">
                            </div>
                        </div>

                        <button type="submit" class="bg-[#EC407A] text-white font-bold py-2 px-4 rounded-lg hover:bg-opacity-90 transition-colors">Guardar Historia</button>
                        <button type="button" id="clear-story-form" class="bg-gray-400 text-white font-bold py-2 px-4 rounded-lg hover:bg-opacity-90 transition-colors ml-2">Limpiar Formulario</button>
                    </form>

                    <h5 class="text-xl font-semibold mt-8 mb-4">Tus Historias Publicadas:</h5>
                    <div id="stories-list" class="space-y-4">
                        <!-- Stories will be loaded here -->
                        <p class="text-gray-500">Cargando historias...</p>
                    </div>
                </div>

                <!-- Sección: Gestión de Apariencia -->
                <div class="bg-white p-8 rounded-lg shadow-md">
                    <h4 class="text-2xl font-semibold mb-6">Gestión de Apariencia (Materia Prima Visual) 🖼️</h4>
                    <p class="text-gray-600 mb-4">Actualizá el logo y el banner de tu sitio pegando la URL pública de la imagen.</p>
                    <p class="text-red-500 text-sm mb-4">Recordá que las URLs de Google Drive deben ser configuradas como "Públicas" o "Cualquier persona con el enlace puede ver" para que se visualicen correctamente.</p>

                    <div class="space-y-6">
                        <div>
                            <label for="logo-url-input" class="block text-gray-700 text-sm font-bold mb-2">Logo Principal (URL pública PNG/JPG):</label>
                            <input type="url" id="logo-url-input" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#EC407A]" placeholder="Pegá aquí la URL pública de tu logo...">
                            <button id="update-logo-btn" class="mt-4 bg-[#673AB7] text-white font-bold py-2 px-4 rounded-lg hover:bg-opacity-90 transition-colors">Actualizar Logo</button>
                            <p class="mt-2 text-sm text-gray-500">Formato recomendado: PNG con fondo transparente para mejor integración. Tamaño original sin comentarios.</p>
                        </div>
                        <div>
                            <label for="banner-url-input" class="block text-gray-700 text-sm font-bold mb-2">Banner de Portada (URL pública PNG/JPG - Ideal 1920x400px):</label>
                            <input type="url" id="banner-url-input" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#EC407A]" placeholder="Pegá aquí la URL pública de tu banner...">
                            <button id="update-banner-btn" class="mt-4 bg-[#673AB7] text-white font-bold py-2 px-4 rounded-lg hover:bg-opacity-90 transition-colors">Actualizar Banner</button>
                            <p class="mt-2 text-sm text-gray-500">Formato recomendado: JPG/PNG. Dimensiones sugeridas: 1920x400 píxeles para una buena visualización en desktop y adaptable a otros tamaños.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-[#1A1A1A] text-white py-6">
        <div class="container mx-auto px-6 text-center">
            <p>&copy; 2025 Pixel Creativo. Un proyecto de e-studio ID345. Creado en Mendoza, Argentina.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const planData = {
                standard: [
                    { name: 'Flyer Individual', price: 4000, priceText: '$4.000 (Agosto 2025)', pieces: 1, features: ['1 Pieza de diseño única.'] },
                    { name: 'Promo Mensual', price: 10000, priceText: '$10.000 (Agosto 2025)', pieces: 4, features: ['4 Diseños por mes.', 'Ideal para prueba inicial.'] },
                    { name: 'Paquete Básico', price: 60000, priceText: '$15.000 /semana o $60.000 /mes (Agosto 2025)', pieces: 4, features: ['4 Flyers estratégicos por mes.', 'Presencia visual constante.', 'Modalidad híbrida, renovación semanal.'] },
                    { name: 'Paquete Avanzado', price: 120000, priceText: '$120.000 /mes (Agosto 2025)', pieces: 8, features: ['8 Piezas de contenido por mes.', 'Ideal para escalar en redes.', 'Difusión viral en nuestras redes para cada pieza entregada.'] },
                    { name: 'Paquete PREMIUM', price: 150000, priceText: '$150.000 /mes (Agosto 2025)', pieces: 12, features: ['12 Piezas de contenido de alta calidad.', 'Posicionamiento de marca superior.', 'Difusión viral en nuestras redes para cada pieza entregada.', 'Publicidad paga para cada pieza entregada.'] },
                ],
                // CM plans are no longer directly displayed in the cards, but the data is kept if needed for other purposes.
                cm: [
                    { name: 'Básico + CM', price: 60000, priceText: '$60.000 /mes', pieces: 4, features: ['4 Piezas de contenido.', 'Gestión de redes básica.', 'Estrategia de difusión viral en Mendoza.'] },
                    { name: 'Avanzado + CM', price: 120000, priceText: '$120.000 /mes', pieces: 8, features: ['8 Piezas de contenido.', 'Gestión de redes completa.', 'Difusión y revista semanal digital "Top 10".'] },
                    { name: 'Premium + CM', price: 150000, priceText: '$150.000 /mes', pieces: 12, features: ['12 Piezas de contenido.', 'Gestión de redes profunda.', 'Difusión, revista y publicidad paga (Google/FB Ads).'] },
                ]
            };

            const planCardsContainer = document.getElementById('plan-cards-container');
            const chartCanvas = document.getElementById('plansChart').getContext('2d');
            let plansChart;

            function createPlanCard(plan) {
                const featuresHtml = plan.features.map(feature => `
                    <li class="flex items-center">
                        <svg class="w-4 h-4 text-[#673AB7] mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                        <span>${feature}</span>
                    </li>
                `).join('');

                const card = document.createElement('div');
                card.className = 'plan-card bg-white p-6 rounded-lg shadow-md flex flex-col';
                card.innerHTML = `
                    <h4 class="text-xl font-bold text-center">${plan.name}</h4>
                    <div class="my-4 text-center text-3xl font-bold text-[#EC407A]">${plan.priceText}</div>
                    <ul class="space-y-2 text-gray-600 flex-grow">
                        ${featuresHtml}
                    </ul>
                `;
                return card;
            }

            function renderStandardPlans() {
                planCardsContainer.innerHTML = '';
                planData.standard.forEach(plan => {
                    planCardsContainer.appendChild(createPlanCard(plan));
                });
            }

            function initializeChart() {
                const monthlyStandardPlans = planData.standard.filter(p => p.price >= 60000); 
                plansChart = new Chart(chartCanvas, {
                    type: 'bar',
                    data: {
                        labels: monthlyStandardPlans.map(p => p.name),
                        datasets: [{
                            label: 'Piezas de Contenido',
                            data: monthlyStandardPlans.map(p => p.pieces),
                            backgroundColor: '#673AB7', /* Accent2 */
                            borderColor: '#212121', /* Text color for border */
                            borderWidth: 1,
                            tooltips: monthlyStandardPlans.map(p => `Precio: ${p.priceText}`)
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(0,0,0,0.05)'
                                }
                            },
                            y: {
                                grid: {
                                    display: false
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    footer: function(tooltipItems) {
                                        const index = tooltipItems[0].dataIndex;
                                        return monthlyStandardPlans[index] ? `Precio: ${monthlyStandardPlans[index].priceText}` : '';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            const requestCmInfoBtn = document.getElementById('request-cm-info-btn');
            requestCmInfoBtn.addEventListener('click', () => {
                document.querySelector('#contacto').scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            });
            
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = e.currentTarget.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    if(targetElement) {
                        targetElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });

            renderStandardPlans();
            initializeChart();

            // Gemini API Integration - Text Models
            const contentIdeaInput = document.getElementById('content-idea-input');
            const contentTypeSelect = document.getElementById('content-type-select');
            const generateIdeasBtn = document.getElementById('generate-ideas-btn');
            const ideaSpinner = document.getElementById('idea-spinner');
            const ideasOutput = document.getElementById('ideas-output');

            const textApiKey = "";
            const textApiUrl = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=";

            async function callGeminiTextAPI(prompt, outputElement, spinnerElement) {
                outputElement.textContent = '';
                spinnerElement.classList.remove('hidden');

                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };

                const maxRetries = 5;
                let retryCount = 0;
                let delay = 1000;

                while (retryCount < maxRetries) {
                    try {
                        const response = await fetch(`${textApiUrl}${textApiKey}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (response.status === 429) {
                            retryCount++;
                            delay *= 2;
                            await new Promise(res => setTimeout(res, delay));
                            continue;
                        }

                        const result = await response.json();
                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            const text = result.candidates[0].content.parts[0].text;
                            outputElement.textContent = text;
                        } else {
                            outputElement.textContent = 'Error: No se pudo generar la respuesta. Intentá de nuevo.';
                        }
                        break;
                    }
                     catch (error) {
                        outputElement.textContent = 'Error de conexión. Intentá de nuevo.';
                        retryCount++;
                        delay *= 2;
                        await new Promise(res => setTimeout(res, delay));
                    }
                }
                spinnerElement.classList.add('hidden');
            }

            generateIdeasBtn.addEventListener('click', () => {
                const topic = contentIdeaInput.value;
                const contentType = contentTypeSelect.value;
                if (topic.trim() === '') {
                    ideasOutput.textContent = 'Por favor, introducí un tema.';
                    return;
                }
                const prompt = `Genera 3 ideas creativas para un ${contentType} sobre el tema: "${topic}". Incluye un título atractivo, un subtítulo o idea principal, y una sugerencia de llamado a la acción.`;
                callGeminiTextAPI(prompt, ideasOutput, ideaSpinner);
            });

            // Gemini API Integration - Image Generation
            const imagePromptInput = document.getElementById('image-prompt-input');
            const generateImageBtn = document.getElementById('generate-image-btn');
            const imageSpinner = document.getElementById('image-spinner');
            const imageOutput = document.getElementById('image-output');

            const imageApiKey = "";
            const imageApiUrl = "https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=";

            async function callGeminiImageAPI(prompt, outputElement, spinnerElement) {
                outputElement.innerHTML = '';
                spinnerElement.classList.remove('hidden');

                const payload = { instances: { prompt: prompt }, parameters: { "sampleCount": 1 } };

                const maxRetries = 5;
                let retryCount = 0;
                let delay = 1000;

                while (retryCount < maxRetries) {
                    try {
                        const response = await fetch(`${imageApiUrl}${imageApiKey}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (response.status === 429) {
                            retryCount++;
                            delay *= 2;
                            await new Promise(res => setTimeout(res, delay));
                            continue;
                        }

                        const result = await response.json();
                        if (result.predictions && result.predictions.length > 0 && result.predictions[0].bytesBase64Encoded) {
                            const imageUrl = `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
                            const imgElement = document.createElement('img');
                            imgElement.src = imageUrl;
                            imgElement.alt = "Imagen Generada";
                            outputElement.innerHTML = '';
                            outputElement.appendChild(imgElement);
                        } else {
                            outputElement.innerHTML = '<p class="text-red-500">Error: No se pudo generar la imagen. Intentá con una descripción diferente.</p>';
                        }
                        break;
                    } catch (error) {
                        outputElement.innerHTML = '<p class="text-red-500">Error de conexión al generar imagen. Intentá de nuevo.</p>';
                        retryCount++;
                        delay *= 2;
                        await new Promise(res => setTimeout(res, delay));
                    }
                }
                spinnerElement.classList.add('hidden');
            }

            generateImageBtn.addEventListener('click', () => {
                const imagePrompt = imagePromptInput.value;
                if (imagePrompt.trim() === '') {
                    imageOutput.innerHTML = '<p class="text-red-500">Por favor, introducí una descripción para la imagen o logo.</p>';
                    return;
                }
                callGeminiImageAPI(imagePrompt, imageOutput, imageSpinner);
            });

            // Developer Mode Logic
            const openDevModeBtn = document.getElementById('open-dev-mode');
            const developerLoginModal = document.getElementById('developer-login-modal');
            const closeLoginModalBtn = document.getElementById('close-login-modal');
            const devModeNavLink = document.getElementById('dev-mode-nav-link');
            const developerModeSection = document.getElementById('developer-mode');


            openDevModeBtn.addEventListener('click', () => {
                developerLoginModal.style.display = 'flex';
            });

            closeLoginModalBtn.addEventListener('click', () => {
                developerLoginModal.style.display = 'none';
            });

            window.addEventListener('click', (event) => {
                if (event.target == developerLoginModal) {
                    developerLoginModal.style.display = 'none';
                }
            });

            // Contact Form Logic
            const openContactModalBtn = document.getElementById('open-contact-modal-btn');
            const contactFormModal = document.getElementById('contact-form-modal');
            const closeContactModalBtn = document.getElementById('close-contact-modal');
            const contactForm = document.getElementById('contact-form');
            const contactNameInput = document.getElementById('contact-name');
            const contactEmailInput = document.getElementById('contact-email');
            const contactPhoneInput = document.getElementById('contact-phone');
            const contactMessageInput = document.getElementById('contact-message');

            openContactModalBtn.addEventListener('click', () => {
                contactFormModal.style.display = 'flex';
            });

            closeContactModalBtn.addEventListener('click', () => {
                contactFormModal.style.display = 'none';
            });

            window.addEventListener('click', (event) => {
                if (event.target == contactFormModal) {
                    contactFormModal.style.display = 'none';
                }
            });

            contactForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const name = contactNameInput.value;
                const email = contactEmailInput.value;
                const phone = contactPhoneInput.value;
                const message = contactMessageInput.value;

                if (!name || !email || !message) {
                    alert("Por favor, completá los campos de Nombre, Correo Electrónico y Mensaje.");
                    return;
                }

                try {
                    const messagesCollection = collection(window.firebaseDb, `artifacts/${window.appId}/public/data/contact_messages`); // Use window.appId
                    await addDoc(messagesCollection, {
                        name,
                        email,
                        phone: phone || 'No proporcionado',
                        message,
                        timestamp: new Date()
                    });
                    alert("¡Mensaje enviado con éxito! Nos pondremos en contacto pronto.");
                    contactForm.reset();
                    contactFormModal.style.display = 'none';
                    loadContactMessages(); // Refresh messages in developer mode if open
                } catch (error) {
                    console.error("Error al enviar mensaje:", error);
                    alert("Error al enviar mensaje. Intentá de nuevo.");
                }
            });


            // Firestore for Stories (within developer mode)
            const storyCreationMatrixForm = document.getElementById('story-creation-matrix');
            const matrixTitleInput = document.getElementById('matrix-title');
            const matrixSummaryInput = document.getElementById('matrix-summary');
            const matrixLanguageInput = document.getElementById('matrix-language');
            const matrixStyleInput = document.getElementById('matrix-style');
            const matrixEmotionInput = document.getElementById('matrix-emotion');
            const matrixArtisticDetailsInput = document.getElementById('matrix-artistic-details');
            const generateStoryTextBtn = document.getElementById('generate-story-text-btn');
            const storyTextSpinner = document.getElementById('story-text-spinner');
            const generatedStoryPreview = document.getElementById('generated-story-preview');
            const previewContent = document.getElementById('preview-content');
            const confirmStoryTextBtn = document.getElementById('confirm-story-text-btn');

            const storyForm = document.getElementById('story-form');
            const storyIdInput = document.getElementById('story-id');
            const storyTitleInput = document.getElementById('story-title');
            const storyContentFinalInput = document.getElementById('story-content-final');
            const storyImageStartInput = document.getElementById('story-image-start');
            const storyImageMiddleInput = document.getElementById('story-image-middle');
            const storyImageEndInput = document.getElementById('story-image-end');
            const storyImageStartPreview = document.getElementById('story-image-start-preview');
            const storyImageMiddlePreview = document.getElementById('story-image-middle-preview');
            const storyImageEndPreview = document.getElementById('story-image-end-preview');

            const storiesList = document.getElementById('stories-list');
            const clearStoryFormBtn = document.getElementById('clear-story-form');

            // Event listeners for image previews (now using URLs)
            storyImageStartInput.addEventListener('input', (e) => { storyImageStartPreview.src = e.target.value; });
            storyImageMiddleInput.addEventListener('input', (e) => { storyImageMiddlePreview.src = e.target.value; });
            storyImageEndInput.addEventListener('input', (e) => { storyImageEndPreview.src = e.target.value; });


            generateStoryTextBtn.addEventListener('click', async () => {
                const title = matrixTitleInput.value;
                const summary = matrixSummaryInput.value;
                const language = matrixLanguageInput.value;
                const style = matrixStyleInput.value;
                const emotion = matrixEmotionInput.value;
                const artisticDetails = matrixArtisticDetailsInput.value;

                if (!title || !summary) {
                    previewContent.textContent = "Por favor, completá al menos el título y el resumen para generar el texto.";
                    generatedStoryPreview.classList.remove('hidden');
                    return;
                }

                const prompt = `Genera un texto para una historia o reflexión que sirva como contenido para un blog de diseño y marketing digital, enfocado en emprendedores.
                Título sugerido: "${title}"
                Resumen del contenido: "${summary}"
                Lenguaje a usar: "${language}"
                Estilo: "${style}"
                Intención emocional: "${emotion}"
                Detalles artísticos/tono: "${artisticDetails}"
                El texto debe ser de aproximadamente 200-300 palabras.`;

                await callGeminiTextAPI(prompt, previewContent, storyTextSpinner);
                generatedStoryPreview.classList.remove('hidden');
            });

            confirmStoryTextBtn.addEventListener('click', () => {
                storyTitleInput.value = matrixTitleInput.value;
                storyContentFinalInput.value = previewContent.textContent;
                storyForm.classList.remove('hidden'); // Show the final story form
                generatedStoryPreview.classList.add('hidden'); // Hide the preview
                alert("Texto cargado. Ahora podés agregar imágenes y guardar la historia.");
            });

            async function saveStory(title, content, imageStart, imageMiddle, imageEnd, id = null) {
                if (!window.developerLoggedIn || !window.developerUserId) {
                    alert("No estás en modo desarrollador.");
                    return;
                }
                try {
                    const storiesCollection = collection(window.firebaseDb, `artifacts/${window.appId}/users/${window.developerUserId}/developer_stories`); // Use window.appId
                    const storyData = { title, content, imageStart, imageMiddle, imageEnd, updatedAt: new Date() };
                    if (id) {
                        const storyRef = doc(storiesCollection, id);
                        await updateDoc(storyRef, storyData);
                        alert("Historia actualizada con éxito.");
                    } else {
                        storyData.createdAt = new Date();
                        await addDoc(storiesCollection, storyData);
                        alert("Historia guardada con éxito.");
                    }
                    storyForm.classList.add('hidden'); // Hide form after saving
                    storyCreationMatrixForm.reset(); // Reset matrix form
                    storyIdInput.value = ''; // Clear ID
                    storyImageStartInput.value = ''; // Clear image URL input
                    storyImageMiddleInput.value = ''; // Clear image URL input
                    storyImageEndInput.value = ''; // Clear image URL input
                    storyImageStartPreview.src = '';
                    storyImageMiddlePreview.src = '';
                    storyImageEndPreview.src = '';
                    loadStories();
                } catch (error) {
                    console.error("Error al guardar/actualizar historia:", error);
                    alert("Error al guardar/actualizar historia: " + error.message);
                }
            }

            async function loadStories() {
                if (!window.developerLoggedIn || !window.developerUserId) {
                    storiesList.innerHTML = '<p class="text-gray-500">Iniciá sesión en el modo desarrollador para ver tus historias.</p>';
                    return;
                }
                storiesList.innerHTML = '<p class="text-gray-500">Cargando historias...</p>';
                try {
                    const storiesCollection = collection(window.firebaseDb, `artifacts/${window.appId}/users/${window.developerUserId}/developer_stories`); // Use window.appId
                    const q = query(storiesCollection, orderBy("createdAt", "desc"));
                    const querySnapshot = await getDocs(q);
                    storiesList.innerHTML = '';
                    if (querySnapshot.empty) {
                        storiesList.innerHTML = '<p class="text-gray-500">Todavía no tenés historias. ¡Creá una!</p>';
                        return;
                    }
                    querySnapshot.forEach((doc) => {
                        const story = doc.data();
                        const storyItem = document.createElement('div');
                        storyItem.className = 'bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200';
                        storyItem.innerHTML = `
                            <h5 class="text-lg font-bold text-[#212121]">${story.title}</h5>
                            ${story.imageStart ? `<img src="${story.imageStart}" alt="Inicio" class="my-2 story-image-preview large-preview">` : ''}
                            <p class="text-gray-700 mt-2 text-sm">${story.content.substring(0, 300)}${story.content.length > 300 ? '...' : ''}</p>
                            ${story.imageMiddle ? `<img src="${story.imageMiddle}" alt="Medio" class="my-2 story-image-preview large-preview">` : ''}
                            <div class="mt-3 flex space-x-2">
                                <button class="edit-story-btn bg-blue-500 text-white text-sm py-1 px-3 rounded hover:bg-blue-600" 
                                    data-id="${doc.id}" 
                                    data-title="${story.title}" 
                                    data-content="${story.content}"
                                    data-image-start="${story.imageStart || ''}"
                                    data-image-middle="${story.imageMiddle || ''}"
                                    data-image-end="${story.imageEnd || ''}">Editar</button>
                                <button class="delete-story-btn bg-red-500 text-white text-sm py-1 px-3 rounded hover:bg-red-600" data-id="${doc.id}">Eliminar</button>
                            </div>
                            ${story.imageEnd ? `<img src="${story.imageEnd}" alt="Final" class="my-2 story-image-preview large-preview">` : ''}
                        `;
                        storiesList.appendChild(storyItem);
                    });

                    storiesList.querySelectorAll('.edit-story-btn').forEach(button => {
                        button.addEventListener('click', (e) => {
                            storyIdInput.value = e.target.dataset.id;
                            storyTitleInput.value = e.target.dataset.title;
                            storyContentFinalInput.value = e.target.dataset.content;
                            storyImageStartInput.value = e.target.dataset.imageStart;
                            storyImageMiddleInput.value = e.target.dataset.imageMiddle;
                            storyImageEndInput.value = e.target.dataset.imageEnd;
                            storyImageStartPreview.src = e.target.dataset.imageStart;
                            storyImageMiddlePreview.src = e.target.dataset.imageMiddle;
                            storyImageEndPreview.src = e.target.dataset.imageEnd;
                            storyForm.classList.remove('hidden'); // Show the form for editing
                            generatedStoryPreview.classList.add('hidden'); // Hide preview
                            alert("Ahora podés editar esta historia en el formulario de arriba.");
                            document.getElementById('developer-mode').scrollIntoView({ behavior: 'smooth' }); // Scroll to form
                        });
                    });

                    storiesList.querySelectorAll('.delete-story-btn').forEach(button => {
                        button.addEventListener('click', async (e) => {
                            if (confirm("¿Estás seguro de que querés eliminar esta historia?")) {
                                const storyId = e.target.dataset.id;
                                await deleteStory(storyId);
                            }
                        });
                    });

                } catch (error) {
                    console.error("Error al cargar historias:", error);
                    storiesList.innerHTML = '<p class="text-red-500">Error al cargar historias. Intentá de nuevo más tarde.</p>';
                }
            }

            async function deleteStory(id) {
                if (!window.developerLoggedIn || !window.developerUserId) return;
                try {
                    const storiesCollection = collection(window.firebaseDb, `artifacts/${window.appId}/users/${window.developerUserId}/developer_stories`); // Use window.appId
                    const storyRef = doc(storiesCollection, id);
                    await deleteDoc(storyRef);
                    alert("Historia eliminada con éxito.");
                    loadStories();
                } catch (error) {
                    console.error("Error al eliminar historia:", error);
                    alert("Error al eliminar historia: " + error.message);
                }
            }

            storyForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const id = storyIdInput.value;
                const title = storyTitleInput.value;
                const content = storyContentFinalInput.value;
                const imageStart = storyImageStartInput.value;
                const imageMiddle = storyImageMiddleInput.value;
                const imageEnd = storyImageEndInput.value;
                saveStory(title, content, imageStart, imageMiddle, imageEnd, id);
            });

            clearStoryFormBtn.addEventListener('click', () => {
                storyForm.reset();
                storyIdInput.value = '';
                storyImageStartPreview.src = '';
                storyImageMiddlePreview.src = '';
                storyImageEndPreview.src = '';
                storyForm.classList.add('hidden'); // Hide the form
                generatedStoryPreview.classList.add('hidden'); // Hide preview
                storyCreationMatrixForm.reset(); // Reset matrix form
            });

            // Developer Settings (Logo and Banner)
            const mainLogoImg = document.getElementById('main-logo');
            const mainBannerImg = document.getElementById('main-banner');
            const logoUrlInput = document.getElementById('logo-url-input');
            const bannerUrlInput = document.getElementById('banner-url-input');
            const updateLogoBtn = document.getElementById('update-logo-btn');
            const updateBannerBtn = document.getElementById('update-banner-btn');

            async function saveDeveloperSetting(key, value) {
                if (!window.developerLoggedIn || !window.developerUserId) {
                    alert("No estás en modo desarrollador para guardar configuraciones.");
                    return;
                }
                try {
                    const settingsDocRef = doc(window.firebaseDb, `artifacts/${window.appId}/users/${window.developerUserId}/settings/visual`); // Use window.appId
                    await setDoc(settingsDocRef, { [key]: value }, { merge: true });
                    alert(`¡${key === 'logoUrl' ? 'Logo' : 'Banner'} actualizado con éxito!`);
                    loadDeveloperSettings(); // Reload to apply changes
                } catch (error) {
                    console.error("Error al guardar configuración:", error);
                    alert("Error al guardar configuración: " + error.message);
                }
            }

            async function loadDeveloperSettings() {
                if (!window.developerUserId) return;

                try {
                    const settingsDocRef = doc(window.firebaseDb, `artifacts/${window.appId}/users/${window.developerUserId}/settings/visual`); // Use window.appId
                    const docSnap = await getDoc(settingsDocRef);

                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        if (data.logoUrl) {
                            mainLogoImg.src = data.logoUrl;
                            logoUrlInput.value = data.logoUrl;
                        }
                        if (data.bannerUrl) {
                            mainBannerImg.src = data.bannerUrl;
                            bannerUrlInput.value = data.bannerUrl;
                        }
                    } else {
                        console.log("No hay configuraciones visuales guardadas para este desarrollador.");
                    }
                } catch (error) {
                    console.error("Error al cargar configuraciones:", error);
                }
            }

            updateLogoBtn.addEventListener('click', () => {
                const logoData = logoUrlInput.value.trim();
                if (logoData) {
                    saveDeveloperSetting('logoUrl', logoData);
                } else {
                    alert("Por favor, pegá la URL de tu logo.");
                }
            });

            updateBannerBtn.addEventListener('click', () => {
                const bannerData = bannerUrlInput.value.trim();
                if (bannerData) {
                    saveDeveloperSetting('bannerUrl', bannerData);
                } else {
                    alert("Por favor, pegá la URL de tu banner.");
                }
            });

            // Contact Messages in Developer Mode
            const contactMessagesList = document.getElementById('contact-messages-list');

            async function loadContactMessages() {
                if (!window.developerLoggedIn || !window.developerUserId) {
                    contactMessagesList.innerHTML = '<p class="text-gray-500">Iniciá sesión en el modo desarrollador para ver los mensajes.</p>';
                    return;
                }
                contactMessagesList.innerHTML = '<p class="text-gray-500">Cargando mensajes...</p>';
                try {
                    // Using public/data for contact messages
                    const messagesCollection = collection(window.firebaseDb, `artifacts/${window.appId}/public/data/contact_messages`); // Use window.appId
                    const q = query(messagesCollection, orderBy("timestamp", "desc"));
                    const querySnapshot = await getDocs(q);
                    contactMessagesList.innerHTML = '';
                    if (querySnapshot.empty) {
                        contactMessagesList.innerHTML = '<p class="text-gray-500">Todavía no hay mensajes en el buzón.</p>';
                        return;
                    }
                    querySnapshot.forEach((doc) => {
                        const msg = doc.data();
                        const messageItem = document.createElement('div');
                        messageItem.className = 'bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200';
                        const timestamp = msg.timestamp ? new Date(msg.timestamp.seconds * 1000).toLocaleString('es-AR') : 'Fecha desconocida';
                        messageItem.innerHTML = `
                            <h5 class="text-lg font-bold text-[#212121]">De: ${msg.name} (${msg.email})</h5>
                            <p class="text-gray-700 text-sm">Teléfono: ${msg.phone}</p>
                            <p class="text-gray-700 mt-2">${msg.message}</p>
                            <p class="text-gray-500 text-xs mt-2">Recibido: ${timestamp}</p>
                            <div class="mt-3 flex justify-end">
                                <button class="delete-message-btn bg-red-500 text-white text-sm py-1 px-3 rounded hover:bg-red-600" data-id="${doc.id}">Eliminar Mensaje</button>
                            </div>
                        `;
                        contactMessagesList.appendChild(messageItem);
                    });

                    contactMessagesList.querySelectorAll('.delete-message-btn').forEach(button => {
                        button.addEventListener('click', async (e) => {
                            if (confirm("¿Estás seguro de que querés eliminar este mensaje?")) {
                                const messageId = e.target.dataset.id;
                                await deleteContactMessage(messageId);
                            }
                        });
                    });

                } catch (error) {
                    console.error("Error al cargar mensajes de contacto:", error);
                    contactMessagesList.innerHTML = '<p class="text-red-500">Error al cargar mensajes. Intentá de nuevo más tarde.</p>';
                }
            }

            async function deleteContactMessage(id) {
                if (!window.developerLoggedIn || !window.developerUserId) return;
                try {
                    const messagesCollection = collection(window.firebaseDb, `artifacts/${window.appId}/public/data/contact_messages`); // Use window.appId
                    const messageRef = doc(messagesCollection, id);
                    await deleteDoc(messageRef);
                    alert("Mensaje eliminado con éxito.");
                    loadContactMessages();
                } catch (error) {
                    console.error("Error al eliminar mensaje:", error);
                    alert("Error al eliminar mensaje: " + error.message);
                }
            }

            // Initial setup for developer mode on page load
            const persistedDevUid = localStorage.getItem(`dev_uid_${window.appId}`); // Use window.appId
            if (persistedDevUid && window.firebaseAuth && !window.firebaseAuth.currentUser) {
                // Attempt to re-authenticate if UID is persisted but not current user
                // This will be handled by onAuthStateChanged if successful
            } else if (window.developerLoggedIn && window.developerUserId) {
                loadStories();
                loadDeveloperSettings();
                loadContactMessages();
            } else {
                developerModeSection.classList.add('hidden');
                devModeNavLink.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
